<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Анализ ОФЦ | Checko</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <header class="hero">
    <div class="container">
      <p class="badge">Исследовательский инструмент</p>
      <h1>Анализ операционного финансового цикла российских компаний</h1>
      <p class="lead">Формулы и расчёты соответствуют методологии кандидатской диссертации. Данные запрашиваются из Checko API с учётом суточного лимита и могут исполняться сразу для нескольких компаний.</p>
    </div>
  </header>

  <main class="container">
    <section class="card">
      <h2>Параметры запроса</h2>
      <form id="analysis-form" class="form-grid">
        <label class="form-field full-row">
          <span>ИНН компаний (по одному в строке)</span>
          <textarea name="inns" rows="3" placeholder="7707083893&#10;1234567890" required></textarea>
        </label>
        <label class="form-field full-row">
          <span>Периоды (год или квартал, формат: 2023 или 2023-Q1, по одному в строке)</span>
          <textarea id="periods" name="periods" rows="3" placeholder="2023&#10;2022&#10;2021-Q1" required></textarea>
          <p id="period-helper" class="help">Периоды сортируются автоматически. Для квартала укажите Q1–Q4. Минимум один период обязателен.</p>
        </label>
        <label class="form-field">
          <span>Режим демонстрации</span>
          <select name="mockMode" id="mockMode">
            <option value="false" selected>Проверка через Checko API</option>
            <option value="true">Демо-данные (без расхода лимита)</option>
          </select>
        </label>
        <fieldset class="full-row checkboxes">
          <legend>Секции запроса (обязательные поля уже отмечены)</legend>
          <label><input type="checkbox" name="sections" value="balance_sheet" checked disabled> Баланс (обязательно)</label>
          <label><input type="checkbox" name="sections" value="income_statement" checked disabled> Отчёт о прибылях и убытках (обязательно)</label>
          <label><input type="checkbox" name="sections" value="cashflow"> Движение денежных средств</label>
          <label><input type="checkbox" name="sections" value="segments"> Прочие сегменты</label>
          <label><input type="checkbox" name="sections" value="notes"> Пояснения/примечания</label>
          <label><input type="checkbox" name="sections" value="extended" checked disabled> Расширенная детализация</label>
        </fieldset>
        <div class="actions full-row">
          <button type="button" id="estimate" class="secondary">Посчитать запросы</button>
          <button type="button" id="check-connection" class="secondary">Проверить соединение</button>
          <button type="submit" class="primary">Запустить анализ</button>
        </div>
      </form>
      <p class="help">Бесплатный тариф Checko ограничен 100 запросами в сутки. Приложение показывает текущий расход, расчёт требуемых запросов и остаток лимита.</p>
      <p class="help">Ключ Checko нужно передать в переменную окружения <code>CHECKO_API_KEY</code>: локально через <code>.env</code> или <code>export</code>, на Vercel — в Project → Settings → Environment Variables.</p>
    </section>

    <section id="status" class="notice hidden"></section>

    <section class="card" id="quota-card">
      <h3>Лимит API</h3>
      <div id="quota-stats" class="quota"></div>
      <div id="local-estimate" class="quota"></div>
      <p class="help">Калькулятор запросов учитывает количество ИНН и периодов. Метка Extended для финансовых показателей устанавливается автоматически.</p>
    </section>

    <section id="results" class="hidden"></section>
  </main>

  <footer class="container footer">
    <p>Формулы: POI = 365 × ((Запасыₜ + Запасыₜ₋₁) / 2) / Себестоимость; PPD = 365 × ((ДЗₜ + ДЗₜ₋₁) / 2) / Выручка; PPA = 365 × ((КЗₜ + КЗₜ₋₁) / 2) / Себестоимость; OFC = POI + PPD - PPA.</p>
  </footer>

  <script src="/app.js"></script>
</body>
</html>
